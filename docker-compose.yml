version: "3"
services:
  mysql:
    container_name: mysql
    image: mysql/mysql-server:5.7
    env_file:
      - .env.prod
    networks:
      - microblog-network

  prod:
    container_name: microblog
    image: microblog:prod
    ports:
      - "8000:5000"
    env_file:
      - .env.prod
    networks:
      - microblog-network
    depends_on:
      - mysql

  test:
    container_name: microblog-test
    image: microblog-test:1.0.0
    volumes:
      - "./app:/microblog/app"
      - "./tests:/microblog/tests"
    environment:
      - MYSQL_USER=${MYSQL_USER}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
      - MYSQL_DATABASE=${MYSQL_DATABASE}
      - SECRET_KEY=${SECRET_KEY}
      - DATABASE_URL=${DATABASE_URL}
    networks:
      - microblog-network
    depends_on:
      - mysql

networks:
  microblog-network:
